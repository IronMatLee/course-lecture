<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Baptiste Racing Lecture</title>

    <!-- PWA Setup -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#2c3e50" />

    <!-- Libs -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Importation des nouvelles polices -->
    <link
      href="https://fonts.googleapis.com/css2?family=Racing+Sans+One&family=Fredoka:wght@400;700&family=Dancing+Script:wght@700&family=Indie+Flower&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      :root {
        --asphalt: #2c3e50;
        --road-line: #f1c40f;
        --grass: #27ae60;
        --sky: #3498db;
        --text-color: #ecf0f1;
        --red-light: #c0392b;
        --green-light: #2ecc71;
        --orange-light: #f39c12;
      }

      body {
        font-family: "Fredoka", sans-serif;
        background-color: var(--asphalt);
        color: var(--text-color);
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* --- BACKGROUND ANIME (ROUTE) --- */
      .road-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: linear-gradient(
            90deg,
            transparent 49%,
            var(--road-line) 49%,
            var(--road-line) 51%,
            transparent 51%
          ),
          linear-gradient(var(--asphalt) 0%, #1a252f 100%);
        background-size: 100% 100px;
        animation: roadMove 0.5s linear infinite; /* Plus rapide pour effet course */
        animation-play-state: paused;
      }

      @keyframes roadMove {
        from {
          background-position: 0 0;
        }
        to {
          background-position: 0 100px;
        }
      }

      .moving .road-bg {
        animation-play-state: running;
      }

      /* --- UI GLOBAL --- */
      #app-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        position: relative;
      }

      h1 {
        font-family: "Racing Sans One", cursive;
        font-size: 3rem;
        text-shadow: 4px 4px 0 #000;
        margin: 20px 0;
        text-align: center;
        color: #fff;
        transform: skew(-10deg);
      }

      .btn-main {
        background: linear-gradient(to bottom, #e74c3c, #c0392b);
        border: 4px solid #fff;
        color: white;
        padding: 20px 40px;
        font-size: 2rem;
        border-radius: 50px;
        font-family: "Racing Sans One", cursive;
        cursor: pointer;
        box-shadow: 0 10px 0 #78281f, 0 15px 20px rgba(0, 0, 0, 0.4);
        transition: transform 0.1s, box-shadow 0.1s;
        text-transform: uppercase;
        width: 80%;
        max-width: 400px;
        margin-bottom: 15px;
      }

      .btn-main:active {
        transform: translateY(10px);
        box-shadow: 0 0 0 #78281f, 0 5px 10px rgba(0, 0, 0, 0.4);
      }

      .btn-secondary {
        background: #34495e;
        border: 2px solid #fff;
        color: white;
        padding: 10px 20px;
        font-size: 1.2rem;
        border-radius: 30px;
        cursor: pointer;
        font-family: "Fredoka", sans-serif;
        margin-top: 10px;
      }

      /* --- MENU SCREEN --- */
      #screen-menu {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        width: 100%;
      }

      /* --- HISTORY SCREEN --- */
      #screen-history {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
      }

      .history-list-container {
        flex: 1;
        width: 100%;
        max-width: 500px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 15px;
        border: 2px solid #fff;
        padding: 10px;
        margin-bottom: 20px;
      }

      .history-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px dashed #777;
        font-size: 1.2rem;
      }
      .history-item:first-child {
        color: var(--road-line);
        font-weight: bold;
      }

      .btn-reset {
        background: #c0392b;
        font-size: 1rem;
        padding: 10px;
        margin-top: 10px;
      }

      /* Animation Voiture Intro (F1 SVG) */
      .drift-car {
        position: fixed;
        bottom: 20%;
        left: -300px;
        width: 250px;
        filter: drop-shadow(10px 10px 5px rgba(0, 0, 0, 0.5));
        animation: driftIntro 2s ease-out forwards;
        z-index: 10;
      }

      @keyframes driftIntro {
        0% {
          left: -300px;
          transform: rotate(0deg);
        }
        60% {
          left: 50%;
          transform: rotate(0deg) scale(1.1);
        }
        80% {
          left: 60%;
          transform: rotate(-10deg) scale(1.1);
        }
        100% {
          left: 120%;
          transform: rotate(0deg);
        }
      }

      /* --- COUNTDOWN SCREEN --- */
      #screen-countdown {
        display: none;
        flex-direction: column;
        align-items: center;
      }

      .traffic-light {
        background: #000;
        padding: 20px;
        border-radius: 20px;
        display: flex;
        gap: 20px;
        border: 5px solid #555;
        margin-bottom: 50px;
      }

      .light {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #333;
        box-shadow: inset 0 0 20px #000;
        transition: background 0.1s;
      }
      .light.red.active {
        background: #ff0000;
        box-shadow: 0 0 50px #ff0000;
      }
      .light.orange.active {
        background: #ffae00;
        box-shadow: 0 0 50px #ffae00;
      }
      .light.green.active {
        background: #00ff00;
        box-shadow: 0 0 50px #00ff00;
      }

      .count-text {
        font-size: 8rem;
        font-family: "Racing Sans One";
        color: white;
      }

      /* --- GAME SCREEN --- */
      #screen-game {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        height: 100%;
        justify-content: flex-start;
        padding: 20px 0;
        box-sizing: border-box;
      }

      .hud {
        display: flex;
        justify-content: space-between;
        width: 90%;
        font-size: 1.5rem;
        font-weight: bold;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 20px;
        border-radius: 50px;
        border: 2px solid #fff;
        margin-bottom: 20px;
      }

      .word-display {
        height: 150px;
        width: 95%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff;
        color: #2c3e50;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
      }

      #current-word {
        font-size: 3.5rem;
        font-weight: bold;
        text-align: center;
        word-break: break-word;
        padding: 10px;
        line-height: 1.1;
      }

      /* Classes de polices al√©atoires */
      .font-classic {
        font-family: "Fredoka", sans-serif;
      }
      .font-script {
        font-family: "Dancing Script", cursive;
        font-size: 4rem !important;
      }
      .font-school {
        font-family: "Indie Flower", cursive;
        font-size: 3.8rem !important;
        font-weight: bold;
      }

      /* Zone de conduite */
      .driving-zone {
        flex: 1;
        width: 100%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: flex-end; /* Voiture en bas */
        padding-bottom: 20px;
        overflow: hidden;
      }

      .player-car {
        width: 180px;
        filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.6));
        animation: carWobble 2s ease-in-out infinite;
        z-index: 5;
      }

      @keyframes carWobble {
        0% {
          transform: translateX(0px) rotate(0deg);
        }
        25% {
          transform: translateX(-20px) rotate(-2deg);
        }
        75% {
          transform: translateX(20px) rotate(2deg);
        }
        100% {
          transform: translateX(0px) rotate(0deg);
        }
      }

      /* Bouton Suivant Fixe */
      .btn-next-word {
        position: absolute;
        bottom: 30px;
        right: 20px;
        background: #27ae60;
        border: 4px solid #fff;
        color: white;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        font-family: "Racing Sans One", cursive;
        font-size: 1.2rem;
        cursor: pointer;
        box-shadow: 0 5px 0 #1e8449, 0 10px 20px rgba(0, 0, 0, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        text-transform: uppercase;
        z-index: 20; /* Au dessus de la voiture */
        transition: transform 0.1s;
      }

      .btn-next-word:active {
        transform: scale(0.95) translateY(5px);
        box-shadow: 0 0 0 #1e8449;
        background: #2ecc71;
      }

      .btn-next-word i {
        font-size: 2rem;
        margin-bottom: 5px;
        display: block;
      }

      /* --- RESULT SCREEN (PODIUM) --- */
      #screen-result {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        text-align: center;
      }

      .podium-container {
        display: flex;
        align-items: flex-end;
        justify-content: center;
        height: 300px;
        width: 100%;
        margin-top: 30px;
      }

      .step {
        width: 100px;
        background: linear-gradient(to bottom, #f1c40f, #d4ac0d);
        border: 2px solid #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        position: relative;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
        padding-bottom: 10px;
      }

      .step-1 {
        height: 200px;
        background: linear-gradient(to bottom, #f1c40f, #b7950b);
        z-index: 2;
      }
      .step-2 {
        height: 140px;
        background: linear-gradient(to bottom, #bdc3c7, #7f8c8d);
        z-index: 1;
      }
      .step-3 {
        height: 90px;
        background: linear-gradient(to bottom, #e67e22, #a04000);
        z-index: 0;
      }

      .rank-num {
        font-size: 3rem;
        font-family: "Racing Sans One";
        color: rgba(255, 255, 255, 0.5);
        line-height: 1;
      }
      .score-on-step {
        font-size: 1.2rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 1px 1px 0 #000;
        margin-top: 5px;
      }

      .avatar {
        font-size: 4rem;
        position: absolute;
        top: -70px;
        animation: bounce 1s infinite alternate;
      }

      .avatar.baptiste {
        color: #3498db;
        text-shadow: 0 0 10px white;
      }

      @keyframes bounce {
        from {
          top: -70px;
        }
        to {
          top: -80px;
        }
      }

      /* Sc√®ne Sp√©ciale Fille */
      .special-reward-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 100;
        text-align: center;
      }

      .scene-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        color: #333;
        max-width: 90%;
        position: relative;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      @keyframes popIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      .couple-emojis {
        font-size: 6rem;
        margin: 20px 0;
        position: relative;
      }

      .kiss-mark {
        position: absolute;
        font-size: 4rem;
        color: #e91e63;
        top: 20%;
        right: 15%;
        opacity: 0;
        transform: scale(0) rotate(-20deg);
        animation: kissAnim 1s 1s forwards;
      }

      @keyframes kissAnim {
        0% {
          opacity: 0;
          transform: scale(2) rotate(-20deg);
        }
        50% {
          opacity: 1;
          transform: scale(1) rotate(-20deg);
        }
        100% {
          opacity: 0.8;
          transform: scale(1) rotate(-20deg);
        }
      }

      .medal-icon {
        font-size: 5rem;
        color: #f1c40f;
        filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        animation: swing 2s infinite ease-in-out;
      }

      @keyframes swing {
        0% {
          transform: rotate(-10deg);
        }
        50% {
          transform: rotate(10deg);
        }
        100% {
          transform: rotate(-10deg);
        }
      }

      .champ-message {
        font-size: 1.5rem;
        color: #f1c40f;
        margin-bottom: 20px;
        font-weight: bold;
        text-shadow: 2px 2px 4px #000;
      }

      /* Version Tag */
      .version-tag {
        position: fixed;
        bottom: 5px;
        left: 5px; /* D√©plac√© √† gauche pour ne pas g√™ner le bouton suivant */
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.3);
        pointer-events: none;
        font-family: sans-serif;
      }

      /* Media Queries */
      @media (max-width: 600px) {
        h1 {
          font-size: 2rem;
        }
        #current-word {
          font-size: 2.5rem;
        }
        .word-display {
          height: 120px;
        }
        .player-car {
          width: 140px;
        }
        .btn-next-word {
          width: 90px;
          height: 90px;
          font-size: 1rem;
          right: 10px;
          bottom: 10px;
        }
      }
    </style>
  </head>
  <body class="moving">
    <!-- Class moving pour animer la route -->

    <div class="road-bg"></div>

    <div id="app-container">
      <!-- INTRO CAR ANIMATION (F1 SVG) -->
      <div class="drift-car" id="intro-car">
        <svg viewBox="0 0 512 200" xmlns="http://www.w3.org/2000/svg">
          <!-- Spoiler Arri√®re -->
          <path d="M10 40 h40 v40 h-40 z" fill="#c0392b" />
          <path d="M50 60 h20 v10 h-20 z" fill="#7f8c8d" />
          <!-- Corps -->
          <path d="M60 80 h300 l80 40 v40 h-440 v-40 z" fill="#e74c3c" />
          <!-- Cockpit -->
          <path d="M250 80 c0 -30 40 -30 60 0" fill="#333" />
          <!-- Roues -->
          <circle
            cx="100"
            cy="160"
            r="35"
            fill="#2c3e50"
            stroke="#111"
            stroke-width="5"
          />
          <circle
            cx="400"
            cy="160"
            r="35"
            fill="#2c3e50"
            stroke="#111"
            stroke-width="5"
          />
          <circle cx="100" cy="160" r="15" fill="#7f8c8d" />
          <circle cx="400" cy="160" r="15" fill="#7f8c8d" />
          <!-- Aileron Avant -->
          <path d="M440 140 h60 l-10 20 h-50 z" fill="#c0392b" />
          <!-- Num√©ro -->
          <text
            x="220"
            y="130"
            font-family="Arial"
            font-weight="bold"
            font-size="40"
            fill="white"
            style="transform: skewX(-10deg)"
          >
            1
          </text>
        </svg>
      </div>

      <!-- MENU -->
      <div id="screen-menu">
        <h1>
          <i class="fa-solid fa-flag-checkered"></i>
          BAPTISTE
          <br />
          RACING
        </h1>

        <button class="btn-main" onclick="startCountdown()">
          D√âMARRER LA COURSE
        </button>
        <button class="btn-secondary" onclick="showHistory()">
          <i class="fa-solid fa-list-ol"></i>
          Historique
        </button>
      </div>

      <!-- HISTORY SCREEN -->
      <div id="screen-history">
        <h1>HISTORIQUE</h1>
        <div class="history-list-container" id="history-container">
          <!-- Liste remplie par JS -->
        </div>
        <button
          class="btn-main"
          onclick="goMenu()"
          style="font-size: 1.5rem; padding: 10px 30px"
        >
          Retour
        </button>
        <button class="btn-secondary btn-reset" onclick="resetScores()">
          <i class="fa-solid fa-trash"></i>
          R√©initialiser
        </button>
      </div>

      <!-- COUNTDOWN -->
      <div id="screen-countdown">
        <div class="traffic-light">
          <div class="light red" id="light-red"></div>
          <div class="light orange" id="light-orange"></div>
          <div class="light green" id="light-green"></div>
        </div>
        <div class="count-text" id="countdown-display">3</div>
      </div>

      <!-- GAME -->
      <div id="screen-game">
        <div class="hud">
          <span>
            <i class="fa-solid fa-stopwatch"></i>
            <span id="timer-display">60</span>
            s
          </span>
          <span>
            <i class="fa-solid fa-star"></i>
            <span id="word-count-display">0</span>
            mots
          </span>
        </div>

        <div class="word-display">
          <div id="current-word">PR√äT ?</div>
        </div>

        <!-- Zone de conduite avec Voiture -->
        <div class="driving-zone">
          <div class="player-car">
            <!-- M√™me SVG que l'intro mais statique -->
            <svg viewBox="0 0 512 200" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 40 h40 v40 h-40 z" fill="#c0392b" />
              <path d="M50 60 h20 v10 h-20 z" fill="#7f8c8d" />
              <path d="M60 80 h300 l80 40 v40 h-440 v-40 z" fill="#e74c3c" />
              <path d="M250 80 c0 -30 40 -30 60 0" fill="#333" />
              <circle
                cx="100"
                cy="160"
                r="35"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="5"
              />
              <circle
                cx="400"
                cy="160"
                r="35"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="5"
              />
              <circle cx="100" cy="160" r="15" fill="#7f8c8d" />
              <circle cx="400" cy="160" r="15" fill="#7f8c8d" />
              <path d="M440 140 h60 l-10 20 h-50 z" fill="#c0392b" />
              <text
                x="220"
                y="130"
                font-family="Arial"
                font-weight="bold"
                font-size="40"
                fill="white"
                style="transform: skewX(-10deg)"
              >
                1
              </text>
            </svg>
          </div>
        </div>

        <!-- Bouton Suivant -->
        <div class="btn-next-word" onclick="nextWord()">
          <div>
            <i class="fa-solid fa-forward"></i>
            SUIVANT
          </div>
        </div>
      </div>

      <!-- RESULT PODIUM -->
      <div id="screen-result">
        <h1 style="font-size: 2rem; margin: 10px 0">COURSE TERMIN√âE !</h1>
        <div class="champ-message">
          Bravo Baptiste, tu es un vrai champion de lecture !
        </div>

        <div class="podium-container" id="podium">
          <!-- G√©n√©r√© par JS -->
        </div>

        <button
          class="btn-main"
          onclick="location.reload()"
          style="margin-top: 30px"
        >
          REJOUER
        </button>
      </div>
    </div>

    <!-- SCENE SPECIALE -->
    <div id="special-reward" class="special-reward-scene">
      <div class="scene-content">
        <h2>INCROYABLE !</h2>
        <p>Une supportrice te remet la m√©daille d'or !</p>
        <div class="couple-emojis">
          üëß ‚ù§Ô∏è üë¶
          <div class="kiss-mark">üíã</div>
        </div>
        <div>
          <i class="fa-solid fa-medal medal-icon"></i>
        </div>
        <p style="margin-top: 20px; font-size: 0.9rem; color: #7f8c8d">
          (Clique pour fermer)
        </p>
      </div>
    </div>

    <div class="version-tag">v3.1</div>

    <script>
      // --- DATA : 350+ Mots (Niveau ~8 ans / CE2) ---
      const wordsDatabase = [
        "Voiture",
        "Moteur",
        "Rapide",
        "Circuit",
        "Pilote",
        "Vitesse",
        "Garage",
        "Volant",
        "Pneu",
        "Route",
        "Camion",
        "V√©lo",
        "Train",
        "Avion",
        "Bateau",
        "Fus√©e",
        "Voyage",
        "Monde",
        "Valise",
        "Carte",
        "√âcole",
        "Classe",
        "Ma√Ætre",
        "Cahier",
        "Stylo",
        "Livre",
        "Histoire",
        "Maths",
        "Po√©sie",
        "Dessin",
        "Maison",
        "Jardin",
        "Chambre",
        "Cuisine",
        "Salon",
        "Fen√™tre",
        "Porte",
        "Toit",
        "Mur",
        "Escalier",
        "Chat",
        "Chien",
        "Oiseau",
        "Poisson",
        "Cheval",
        "Vache",
        "Mouton",
        "Poule",
        "Lapin",
        "Tigre",
        "Lion",
        "√âl√©phant",
        "Girafe",
        "Singe",
        "Z√®bre",
        "Loup",
        "Ours",
        "Renard",
        "Aigle",
        "Requin",
        "Pomme",
        "Poire",
        "Banane",
        "Fraise",
        "Cerise",
        "Orange",
        "Citron",
        "Raisin",
        "Melon",
        "P√™che",
        "Pain",
        "Beurre",
        "Lait",
        "Fromage",
        "Oeuf",
        "Viande",
        "Poulet",
        "Frites",
        "Pizza",
        "P√¢tes",
        "Eau",
        "Jus",
        "Soda",
        "Glace",
        "G√¢teau",
        "Bonbon",
        "Chocolat",
        "Sucre",
        "Sel",
        "Poivre",
        "Rouge",
        "Bleu",
        "Vert",
        "Jaune",
        "Noir",
        "Blanc",
        "Gris",
        "Rose",
        "Violet",
        "Orange",
        "Grand",
        "Petit",
        "Gros",
        "Mince",
        "Long",
        "Court",
        "Haut",
        "Bas",
        "Large",
        "√âtroit",
        "Beau",
        "Joli",
        "Laid",
        "Propre",
        "Sale",
        "Chaud",
        "Froid",
        "Sec",
        "Mouill√©",
        "Dur",
        "Gentil",
        "M√©chant",
        "Triste",
        "Joyeux",
        "F√¢ch√©",
        "Peureux",
        "Courageux",
        "Fort",
        "Faible",
        "Malade",
        "Courir",
        "Marcher",
        "Sauter",
        "Voler",
        "Nager",
        "Danser",
        "Chanter",
        "Parler",
        "√âcouter",
        "Regarder",
        "Manger",
        "Boire",
        "Dormir",
        "R√™ver",
        "Jouer",
        "Gagner",
        "Perdre",
        "Lire",
        "√âcrire",
        "Compter",
        "Aimer",
        "D√©tester",
        "Vouloir",
        "Pouvoir",
        "Savoir",
        "Devoir",
        "Prendre",
        "Donner",
        "Jeter",
        "Attraper",
        "Ouvrir",
        "Fermer",
        "Allumer",
        "√âteindre",
        "Monter",
        "Descendre",
        "Entrer",
        "Sortir",
        "Partir",
        "Rester",
        "Soleil",
        "Lune",
        "√âtoile",
        "Nuage",
        "Pluie",
        "Neige",
        "Vent",
        "Orage",
        "Ciel",
        "Terre",
        "Mer",
        "Oc√©an",
        "Rivi√®re",
        "Lac",
        "Montagne",
        "Colline",
        "For√™t",
        "Arbre",
        "Fleur",
        "Herbe",
        "Ville",
        "Village",
        "Rue",
        "Pont",
        "Place",
        "Parc",
        "Magasin",
        "March√©",
        "H√¥pital",
        "Cin√©ma",
        "Matin",
        "Midi",
        "Soir",
        "Nuit",
        "Jour",
        "Semaine",
        "Mois",
        "Ann√©e",
        "Heure",
        "Minute",
        "Lundi",
        "Mardi",
        "Mercredi",
        "Jeudi",
        "Vendredi",
        "Samedi",
        "Dimanche",
        "Janvier",
        "F√©vrier",
        "Mars",
        "Printemps",
        "√ât√©",
        "Automne",
        "Hiver",
        "No√´l",
        "P√¢ques",
        "Vacances",
        "F√™te",
        "Anniversaire",
        "Cadeau",
        "Un",
        "Deux",
        "Trois",
        "Quatre",
        "Cinq",
        "Six",
        "Sept",
        "Huit",
        "Neuf",
        "Dix",
        "Onze",
        "Douze",
        "Treize",
        "Quatorze",
        "Quinze",
        "Seize",
        "Vingt",
        "Trente",
        "Quarante",
        "Cinquante",
        "Cent",
        "Mille",
        "Million",
        "Premier",
        "Dernier",
        "Avant",
        "Apr√®s",
        "Maintenant",
        "Demain",
        "Hier",
        "Moi",
        "Toi",
        "Lui",
        "Elle",
        "Nous",
        "Vous",
        "Ils",
        "Elles",
        "Mon",
        "Ton",
        "Son",
        "Notre",
        "Votre",
        "Leur",
        "Le",
        "La",
        "Les",
        "Un",
        "Une",
        "Des",
        "Et",
        "Ou",
        "Mais",
        "Donc",
        "Car",
        "Parce que",
        "Quand",
        "O√π",
        "Comment",
        "Pourquoi",
        "Biblioth√®que",
        "Ordinateur",
        "T√©l√©vision",
        "T√©l√©phone",
        "Internet",
        "Jeux",
        "Vid√©o",
        "Musique",
        "Sport",
        "Ballon",
        "Dinosaure",
        "Pirate",
        "Chevalier",
        "Princesse",
        "Ch√¢teau",
        "Dragon",
        "F√©e",
        "Sorcier",
        "Magie",
        "Tr√©sor",
      ];

      // --- VARIABLES ---
      let currentScore = 0;
      let timeLeft = 60;
      let timerInterval;
      let gameActive = false;
      let availableWords = [];
      let audioCtx;

      // --- INIT ---
      window.onload = function () {
        // Audio context setup
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();
      };

      // --- SOUND ENGINE ---
      // Son de d√©marrage (Rev moteur)
      function playStartSound() {
        if (!audioCtx) return;
        if (audioCtx.state === "suspended") audioCtx.resume();

        const t = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = "sawtooth";
        // Mont√©e en r√©gime
        osc.frequency.setValueAtTime(100, t);
        osc.frequency.exponentialRampToValueAtTime(600, t + 0.8);
        osc.frequency.linearRampToValueAtTime(100, t + 1.2);

        gain.gain.setValueAtTime(0.3, t);
        gain.gain.linearRampToValueAtTime(0, t + 1.2);

        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(t + 1.3);
      }

      // Son Acc√©l√©ration "Vroum" (Passage de mot)
      function playEngineSound() {
        if (!audioCtx) return;
        if (audioCtx.state === "suspended") audioCtx.resume();

        const t = audioCtx.currentTime;

        // Oscillateur 1 (Base grave)
        const osc1 = audioCtx.createOscillator();
        const gain1 = audioCtx.createGain();
        osc1.type = "sawtooth";
        osc1.frequency.setValueAtTime(120, t);
        osc1.frequency.linearRampToValueAtTime(400, t + 0.2); // Mont√©e rapide
        gain1.gain.setValueAtTime(0.2, t);
        gain1.gain.exponentialRampToValueAtTime(0.01, t + 0.3);

        // Connexions
        osc1.connect(gain1);
        gain1.connect(audioCtx.destination);

        osc1.start();
        osc1.stop(t + 0.3);
      }

      // --- NAVIGATION ---
      function goMenu() {
        document.getElementById("screen-history").style.display = "none";
        document.getElementById("screen-menu").style.display = "flex";
      }

      function showHistory() {
        document.getElementById("screen-menu").style.display = "none";
        document.getElementById("screen-history").style.display = "flex";

        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];
        const container = document.getElementById("history-container");

        if (scores.length === 0) {
          container.innerHTML =
            "<div style='color:#ccc; text-align:center;'>Aucune course enregistr√©e</div>";
        } else {
          container.innerHTML = scores
            .map(
              (s, i) =>
                `<div class="history-item">
                        <span>#${i + 1}</span>
                        <span>${s} mots</span>
                    </div>`
            )
            .join("");
        }
      }

      function resetScores() {
        if (confirm("Effacer tout l'historique ?")) {
          localStorage.removeItem("baptiste_racing_scores");
          showHistory(); // Refresh
        }
      }

      // --- JEU ---

      function startCountdown() {
        playStartSound(); // VROUM au d√©marrage

        document.getElementById("screen-menu").style.display = "none";
        document.getElementById("screen-countdown").style.display = "flex";

        availableWords = [...wordsDatabase].sort(() => Math.random() - 0.5);
        currentScore = 0;
        timeLeft = 60;

        const lights = {
          red: document.getElementById("light-red"),
          orange: document.getElementById("light-orange"),
          green: document.getElementById("light-green"),
        };
        const countText = document.getElementById("countdown-display");

        // Reset lights
        lights.red.className = "light red";
        lights.orange.className = "light orange";
        lights.green.className = "light green";

        // Sequence
        setTimeout(() => {
          lights.red.classList.add("active");
          countText.innerText = "3";
          playBeep(400);
        }, 500);
        setTimeout(() => {
          lights.orange.classList.add("active");
          countText.innerText = "2";
          playBeep(400);
        }, 1500);
        setTimeout(() => {
          lights.red.classList.remove("active");
          lights.orange.classList.remove("active");
          lights.green.classList.add("active");
          countText.innerText = "1";
          playBeep(400);
        }, 2500);

        setTimeout(() => {
          countText.innerText = "GO !";
          playBeep(800);
          setTimeout(startGame, 500);
        }, 3500);
      }

      function playBeep(freq) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.value = freq;
        osc.type = "square";
        gain.gain.value = 0.1;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
      }

      function startGame() {
        document.getElementById("screen-countdown").style.display = "none";
        document.getElementById("screen-game").style.display = "flex";
        gameActive = true;

        updateHUD();
        showNextWord();

        timerInterval = setInterval(() => {
          timeLeft--;
          updateHUD();
          if (timeLeft <= 0) {
            endGame();
          }
        }, 1000);
      }

      function nextWord() {
        if (!gameActive) return;

        // Animation bouton
        const btn = document.querySelector(".btn-next-word");
        btn.style.transform = "scale(0.95)";
        setTimeout(() => (btn.style.transform = "scale(1)"), 100);

        playEngineSound();
        currentScore++;
        updateHUD();
        showNextWord();
      }

      function showNextWord() {
        if (availableWords.length === 0)
          availableWords = [...wordsDatabase].sort(() => Math.random() - 0.5);
        const word = availableWords.pop();
        const wordEl = document.getElementById("current-word");
        wordEl.innerText = word;

        // Changement de police al√©atoire
        const fonts = ["font-classic", "font-script", "font-school"];
        wordEl.className = fonts[Math.floor(Math.random() * fonts.length)];
      }

      function updateHUD() {
        document.getElementById("timer-display").innerText = timeLeft;
        document.getElementById("word-count-display").innerText = currentScore;

        if (timeLeft <= 10) {
          document.getElementById("timer-display").style.color = "#e74c3c";
        }
      }

      function endGame() {
        clearInterval(timerInterval);
        gameActive = false;
        document.getElementById("screen-game").style.display = "none";
        document.getElementById("screen-result").style.display = "flex";
        document.getElementById("final-score").innerText = currentScore;

        saveScore(currentScore);
        showPodium(currentScore);

        // Feu d'artifice Intense
        launchFireworks();
      }

      function launchFireworks() {
        const duration = 5000;
        const animationEnd = Date.now() + duration;
        const defaults = {
          startVelocity: 30,
          spread: 360,
          ticks: 60,
          zIndex: 0,
        };

        const interval = setInterval(function () {
          const timeLeft = animationEnd - Date.now();

          if (timeLeft <= 0) {
            return clearInterval(interval);
          }

          const particleCount = 50 * (timeLeft / duration);
          // since particles fall down, start a bit higher than random
          confetti(
            Object.assign({}, defaults, {
              particleCount,
              origin: { x: Math.random(), y: Math.random() - 0.2 },
            })
          );
          confetti(
            Object.assign({}, defaults, {
              particleCount,
              origin: { x: Math.random(), y: Math.random() - 0.2 },
            })
          );
        }, 250);
      }

      // --- HIGHSCORES & PODIUM ---

      function saveScore(score) {
        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];
        scores.push(score);
        scores.sort((a, b) => b - a); // Descendant (Meilleur en premier)
        localStorage.setItem("baptiste_racing_scores", JSON.stringify(scores));
      }

      function showPodium(newScore) {
        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];

        const top1 = scores[0] || 0;
        const top2 = scores[1] || 0;
        const top3 = scores[2] || 0;

        const rank = scores.indexOf(newScore) + 1; // 1 = 1er

        const podiumDiv = document.getElementById("podium");
        podiumDiv.innerHTML = `
                <div class="step step-2">
                    <div class="rank-num">2</div>
                    <div class="score-on-step">${top2}</div>
                    ${
                      rank === 2
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
                <div class="step step-1">
                    <div class="rank-num">1</div>
                    <div class="score-on-step">${top1}</div>
                    ${
                      rank === 1
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
                <div class="step step-3">
                    <div class="rank-num">3</div>
                    <div class="score-on-step">${top3}</div>
                    ${
                      rank === 3
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
            `;

        // Sc√®ne Sp√©ciale "Fille/Bisou" si hors podium (Rank > 3)
        if (rank > 3) {
          setTimeout(() => {
            document.getElementById("special-reward").style.display = "flex";
            document.getElementById("special-reward").onclick = function () {
              this.style.display = "none";
            };
          }, 2000);
        }
      }
    </script>
  </body>
</html>
