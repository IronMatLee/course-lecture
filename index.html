<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Baptiste Racing Lecture</title>

    <!-- Favicon F1 Rouge (Format Carr√© et Encodage URL Strict) -->
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='30' y='10' width='40' height='80' rx='10' fill='%23e74c3c' stroke='%23c0392b' stroke-width='2'/%3E%3Ccircle cx='30' cy='25' r='8' fill='%23333'/%3E%3Ccircle cx='70' cy='25' r='8' fill='%23333'/%3E%3Ccircle cx='30' cy='75' r='8' fill='%23333'/%3E%3Ccircle cx='70' cy='75' r='8' fill='%23333'/%3E%3Crect x='40' y='40' width='20' height='15' rx='5' fill='%23333'/%3E%3Ccircle cx='50' cy='47' r='3' fill='%23f1c40f'/%3E%3C/svg%3E"
    />

    <!-- PWA Setup -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#2c3e50" />

    <!-- Libs -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Racing+Sans+One&family=Fredoka:wght@400;700&family=Dancing+Script:wght@700&family=Indie+Flower&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      :root {
        --asphalt: #2c3e50;
        --road-line: #f1c40f;
        --text-color: #ecf0f1;
        --red-light: #c0392b;
        --green-light: #2ecc71;
      }

      body {
        font-family: "Fredoka", sans-serif;
        background-color: var(--asphalt);
        color: var(--text-color);
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* --- BACKGROUND ANIME --- */
      .road-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: linear-gradient(to bottom, #34495e 0%, #2c3e50 100%),
          repeating-linear-gradient(
            to bottom,
            transparent 0,
            transparent 50px,
            rgba(255, 255, 255, 0.2) 50px,
            rgba(255, 255, 255, 0.2) 100px
          );
        background-blend-mode: overlay;
      }

      .road-bg::after {
        content: "";
        position: absolute;
        left: 50%;
        top: -100px;
        bottom: 0;
        width: 10px;
        background: repeating-linear-gradient(
          to bottom,
          var(--road-line) 0,
          var(--road-line) 80px,
          transparent 80px,
          transparent 160px
        );
        transform: translateX(-50%);
        animation: roadScroll 0.6s linear infinite;
        animation-play-state: paused;
      }

      @keyframes roadScroll {
        from {
          transform: translateX(-50%) translateY(0);
        }
        to {
          transform: translateX(-50%) translateY(160px);
        }
      }
      .moving .road-bg::after {
        animation-play-state: running;
      }

      /* --- UI GLOBAL --- */
      #app-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        position: relative;
      }

      h1 {
        font-family: "Racing Sans One", cursive;
        font-size: 3rem;
        text-shadow: 4px 4px 0 #000;
        margin: 10px 0;
        text-align: center;
        color: #fff;
        transform: skew(-10deg);
        white-space: nowrap;
        width: 100%;
      }

      .btn-main {
        background: linear-gradient(to bottom, #e74c3c, #c0392b);
        border: 4px solid #fff;
        color: white;
        padding: 15px 25px;
        font-size: 1.8rem;
        border-radius: 50px;
        font-family: "Racing Sans One", cursive;
        cursor: pointer;
        box-shadow: 0 10px 0 #78281f, 0 15px 20px rgba(0, 0, 0, 0.4);
        transition: transform 0.1s, box-shadow 0.1s;
        text-transform: uppercase;
        width: 90%;
        max-width: 450px;
        margin-bottom: 15px;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }

      .btn-main:active {
        transform: translateY(10px);
        box-shadow: 0 0 0 #78281f, 0 5px 10px rgba(0, 0, 0, 0.4);
      }

      .btn-secondary {
        background: #34495e;
        border: 2px solid #fff;
        color: white;
        padding: 10px 20px;
        font-size: 1.2rem;
        border-radius: 30px;
        cursor: pointer;
        font-family: "Fredoka", sans-serif;
        margin-top: 10px;
        z-index: 20;
      }

      /* --- MENU SCREEN --- */
      #screen-menu {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        gap: 10px;
        width: 100%;
        padding-top: 20px;
        height: 100%;
      }

      .menu-car-display {
        width: 140px;
        margin: 10px 0;
        filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.5));
        animation: idleWobble 2s ease-in-out infinite;
      }
      @keyframes idleWobble {
        0%,
        100% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(2deg);
        }
      }

      /* --- HISTORY SCREEN --- */
      #screen-history {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
      }
      .history-list-container {
        flex: 1;
        width: 100%;
        max-width: 600px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 15px;
        border: 2px solid #fff;
        padding: 10px;
        margin-bottom: 20px;
      }
      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px dashed #777;
        font-size: 1.2rem;
      }
      .history-item:first-child {
        color: var(--road-line);
        font-weight: bold;
      }

      .history-date {
        font-size: 0.8rem;
        color: #aaa;
        margin-left: 10px;
        display: block;
      }
      .history-score {
        font-weight: bold;
      }

      .btn-reset {
        background: #c0392b;
        font-size: 1rem;
        padding: 10px;
        margin-top: 10px;
      }

      /* --- COUNTDOWN --- */
      #screen-countdown {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
      }
      .traffic-light {
        background: #000;
        padding: 20px;
        border-radius: 20px;
        display: flex;
        gap: 20px;
        border: 5px solid #555;
        margin-bottom: 50px;
      }
      .light {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #333;
        box-shadow: inset 0 0 20px #000;
        transition: background 0.1s;
      }
      .light.red.active {
        background: #ff0000;
        box-shadow: 0 0 50px #ff0000;
      }
      .light.orange.active {
        background: #ffae00;
        box-shadow: 0 0 50px #ffae00;
      }
      .light.green.active {
        background: #00ff00;
        box-shadow: 0 0 50px #00ff00;
      }
      .count-text {
        font-size: 8rem;
        font-family: "Racing Sans One";
        color: white;
      }

      /* --- GAME SCREEN --- */
      #screen-game {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        height: 100%;
        justify-content: flex-start;
        padding: 20px 0;
        box-sizing: border-box;
      }

      .hud {
        display: flex;
        justify-content: space-between;
        width: 90%;
        font-size: 1.5rem;
        font-weight: bold;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 20px;
        border-radius: 50px;
        border: 2px solid #fff;
        margin-bottom: 20px;
      }

      /* Container Ligne de Jeu (Mot + Bouton) */
      .game-row {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 95%;
        gap: 15px; /* Espace entre mot et bouton */
        margin-bottom: 10px;
      }

      .word-display {
        flex: 1; /* Prend toute la place restante */
        height: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff;
        color: #2c3e50;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        position: relative;
        overflow: hidden;
        z-index: 20;
      }

      #current-word {
        font-size: 5rem; /* SUPER GROS */
        font-weight: bold;
        text-align: center;
        word-break: break-word;
        padding: 5px;
        line-height: 1; /* Interligne serr√© */
        width: 100%;
      }

      /* Bouton Suivant (Maintenant √† droite) */
      .btn-next-word {
        width: 110px;
        height: 110px;
        background: #27ae60;
        border: 4px solid #fff;
        color: white;
        border-radius: 50%;
        font-family: "Racing Sans One", cursive;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 5px 0 #1e8449, 0 10px 20px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-transform: uppercase;
        z-index: 20;
        transition: all 0.1s;
        flex-shrink: 0; /* Ne r√©tr√©cit pas */
      }

      .btn-next-word:active {
        transform: translateY(5px);
        box-shadow: 0 0 0 #1e8449;
        background: #2ecc71;
      }
      .btn-next-word i {
        font-size: 2rem;
        margin-bottom: 2px;
      }

      /* Zone de conduite (Voiture seule) */
      .driving-zone {
        flex: 1;
        width: 100%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      .player-car-container {
        width: 120px;
        height: 200px;
        filter: drop-shadow(0 20px 20px rgba(0, 0, 0, 0.6));
        animation: carVibration 0.2s linear infinite;
        z-index: 5;
      }
      @keyframes carVibration {
        0% {
          transform: translateX(-1px);
        }
        50% {
          transform: translateX(1px);
        }
        100% {
          transform: translateX(-1px);
        }
      }

      /* SVG F1 VUE DESSUS */
      .player-car-svg {
        width: 100%;
        height: 100%;
      }

      /* --- RESULT SCREEN (PODIUM) --- */
      #screen-result {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
        text-align: center;
      }

      .podium-container {
        display: flex;
        align-items: flex-end;
        justify-content: center;
        height: 300px;
        width: 100%;
        margin-top: 20px;
      }

      .step {
        width: 100px;
        background: linear-gradient(to bottom, #f1c40f, #d4ac0d);
        border: 2px solid #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        position: relative;
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
        padding-bottom: 10px;
      }
      .step-1 {
        height: 200px;
        background: linear-gradient(to bottom, #f1c40f, #b7950b);
        z-index: 2;
      }
      .step-2 {
        height: 140px;
        background: linear-gradient(to bottom, #bdc3c7, #7f8c8d);
        z-index: 1;
      }
      .step-3 {
        height: 90px;
        background: linear-gradient(to bottom, #e67e22, #a04000);
        z-index: 0;
      }

      .rank-num {
        font-size: 3rem;
        font-family: "Racing Sans One";
        color: rgba(255, 255, 255, 0.5);
        line-height: 1;
      }
      .score-on-step {
        font-size: 1.2rem;
        font-weight: bold;
        color: #fff;
        text-shadow: 1px 1px 0 #000;
        margin-top: 5px;
      }

      .avatar {
        font-size: 4rem;
        position: absolute;
        top: -70px;
        animation: bounce 1s infinite alternate;
      }
      .avatar.baptiste {
        color: #3498db;
        text-shadow: 0 0 10px white;
      }
      @keyframes bounce {
        from {
          top: -70px;
        }
        to {
          top: -80px;
        }
      }

      .champ-message {
        font-size: 1.5rem;
        color: #f1c40f;
        margin-bottom: 10px;
        font-weight: bold;
        text-shadow: 2px 2px 4px #000;
        max-width: 90%;
      }

      /* SCENE SPECIALE */
      .special-reward-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 100;
        text-align: center;
      }
      .scene-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        color: #333;
        max-width: 90%;
        position: relative;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      @keyframes popIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }
      .couple-emojis {
        font-size: 6rem;
        margin: 20px 0;
        position: relative;
      }
      .kiss-mark {
        position: absolute;
        font-size: 4rem;
        color: #e91e63;
        top: 20%;
        right: 15%;
        opacity: 0;
        transform: scale(0) rotate(-20deg);
        animation: kissAnim 1s 1s forwards;
      }
      @keyframes kissAnim {
        0% {
          opacity: 0;
          transform: scale(2);
        }
        100% {
          opacity: 0.8;
          transform: scale(1) rotate(-20deg);
        }
      }
      .medal-icon {
        font-size: 5rem;
        color: #f1c40f;
        filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        animation: swing 2s infinite ease-in-out;
      }
      @keyframes swing {
        0% {
          transform: rotate(-10deg);
        }
        50% {
          transform: rotate(10deg);
        }
        100% {
          transform: rotate(-10deg);
        }
      }

      .version-tag {
        position: fixed;
        bottom: 5px;
        left: 5px;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.3);
        pointer-events: none;
        font-family: sans-serif;
      }

      /* Media Queries */
      @media (max-width: 600px) {
        h1 {
          font-size: 2.2rem;
        }
        #current-word {
          font-size: 3.5rem;
        } /* Ajustement Mobile */
        .word-display {
          height: 120px;
        }
        .player-car-container {
          width: 100px;
          height: 160px;
        }
        .btn-next-word {
          width: 90px;
          height: 90px;
          font-size: 0.9rem;
        }
        .btn-next-word i {
          font-size: 1.5rem;
        }
        .menu-car-display {
          width: 120px;
        }
      }

      /* Polices */
      .font-classic {
        font-family: "Fredoka", sans-serif;
      }
      .font-script {
        font-family: "Dancing Script", cursive;
        font-size: 1.2em !important;
      }
      .font-school {
        font-family: "Indie Flower", cursive;
        font-size: 1.1em !important;
        font-weight: bold;
      }
    </style>
  </head>
  <body class="moving">
    <div class="road-bg"></div>

    <div id="app-container">
      <!-- MENU -->
      <div id="screen-menu">
        <h1>BAPTISTE RACING</h1>

        <button class="btn-main" onclick="startCountdown()">
          <i class="fa-solid fa-flag-checkered"></i>
          D√âMARRER LA COURSE
        </button>

        <div class="menu-car-display">
          <svg viewBox="0 0 200 400" xmlns="http://www.w3.org/2000/svg">
            <rect
              x="20"
              y="20"
              width="160"
              height="30"
              rx="5"
              fill="#e74c3c"
              stroke="#c0392b"
              stroke-width="2"
            />
            <rect
              x="0"
              y="60"
              width="40"
              height="70"
              rx="10"
              fill="#2c3e50"
              stroke="#111"
              stroke-width="2"
            />
            <rect
              x="160"
              y="60"
              width="40"
              height="70"
              rx="10"
              fill="#2c3e50"
              stroke="#111"
              stroke-width="2"
            />
            <path d="M80 50 L120 50 L110 120 L90 120 Z" fill="#e74c3c" />
            <path d="M60 120 L140 120 L140 300 L60 300 Z" fill="#e74c3c" />
            <circle
              cx="100"
              cy="180"
              r="25"
              fill="#333"
              stroke="#111"
              stroke-width="2"
            />
            <circle cx="100" cy="180" r="12" fill="#f1c40f" />
            <rect
              x="0"
              y="250"
              width="45"
              height="80"
              rx="10"
              fill="#2c3e50"
              stroke="#111"
              stroke-width="2"
            />
            <rect
              x="155"
              y="250"
              width="45"
              height="80"
              rx="10"
              fill="#2c3e50"
              stroke="#111"
              stroke-width="2"
            />
            <rect
              x="30"
              y="340"
              width="140"
              height="40"
              rx="5"
              fill="#e74c3c"
              stroke="#c0392b"
              stroke-width="2"
            />
            <text
              x="100"
              y="260"
              font-family="Arial"
              font-weight="bold"
              font-size="40"
              fill="white"
              text-anchor="middle"
            >
              1
            </text>
          </svg>
        </div>

        <button class="btn-secondary" onclick="showHistory()">
          <i class="fa-solid fa-list-ol"></i>
          Historique
        </button>
      </div>

      <!-- HISTORY -->
      <div id="screen-history">
        <h1>HISTORIQUE</h1>
        <div class="history-list-container" id="history-container"></div>
        <button
          class="btn-main"
          onclick="goMenu()"
          style="font-size: 1.5rem; padding: 10px 30px"
        >
          Retour
        </button>
        <button class="btn-secondary btn-reset" onclick="resetScores()">
          <i class="fa-solid fa-trash"></i>
          R√©initialiser
        </button>
      </div>

      <!-- COUNTDOWN -->
      <div id="screen-countdown">
        <div class="traffic-light">
          <div class="light red" id="light-red"></div>
          <div class="light orange" id="light-orange"></div>
          <div class="light green" id="light-green"></div>
        </div>
        <div class="count-text" id="countdown-display">3</div>
      </div>

      <!-- GAME -->
      <div id="screen-game">
        <div class="hud">
          <span>
            <i class="fa-solid fa-stopwatch"></i>
            <span id="timer-display">60</span>
            s
          </span>
          <span>
            <i class="fa-solid fa-star"></i>
            <span id="word-count-display">0</span>
            mots
          </span>
        </div>

        <!-- Nouvelle Ligne Mot + Bouton -->
        <div class="game-row">
          <div class="word-display">
            <div id="current-word">PR√äT ?</div>
          </div>
          <!-- Bouton Suivant Fixe -->
          <div class="btn-next-word" onclick="nextWord()">
            <i class="fa-solid fa-forward"></i>
            SUIVANT
          </div>
        </div>

        <!-- Zone de conduite (Voiture seule) -->
        <div class="driving-zone">
          <div class="player-car-container">
            <svg
              class="player-car-svg"
              viewBox="0 0 200 400"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                x="20"
                y="20"
                width="160"
                height="30"
                rx="5"
                fill="#e74c3c"
                stroke="#c0392b"
                stroke-width="2"
              />
              <rect
                x="0"
                y="60"
                width="40"
                height="70"
                rx="10"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="2"
              />
              <rect
                x="160"
                y="60"
                width="40"
                height="70"
                rx="10"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="2"
              />
              <path d="M80 50 L120 50 L110 120 L90 120 Z" fill="#e74c3c" />
              <path d="M60 120 L140 120 L140 300 L60 300 Z" fill="#e74c3c" />
              <circle
                cx="100"
                cy="180"
                r="25"
                fill="#333"
                stroke="#111"
                stroke-width="2"
              />
              <circle cx="100" cy="180" r="12" fill="#f1c40f" />
              <rect
                x="0"
                y="250"
                width="45"
                height="80"
                rx="10"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="2"
              />
              <rect
                x="155"
                y="250"
                width="45"
                height="80"
                rx="10"
                fill="#2c3e50"
                stroke="#111"
                stroke-width="2"
              />
              <rect
                x="30"
                y="340"
                width="140"
                height="40"
                rx="5"
                fill="#e74c3c"
                stroke="#c0392b"
                stroke-width="2"
              />
              <text
                x="100"
                y="260"
                font-family="Arial"
                font-weight="bold"
                font-size="40"
                fill="white"
                text-anchor="middle"
              >
                1
              </text>
            </svg>
          </div>
        </div>
      </div>

      <!-- RESULT PODIUM -->
      <div id="screen-result">
        <h1 style="font-size: 2rem; margin: 10px 0">COURSE TERMIN√âE !</h1>
        <!-- Message texte qui sera mis √† jour dynamiquement -->
        <div class="champ-message" id="champ-message-text">
          Bravo Baptiste !
        </div>

        <div class="podium-container" id="podium">
          <!-- G√©n√©r√© par JS -->
        </div>

        <div
          style="
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-direction: column;
            align-items: center;
            width: 100%;
          "
        >
          <button class="btn-main" onclick="location.reload()">REJOUER</button>
          <button class="btn-secondary" onclick="showHistory()">
            <i class="fa-solid fa-list-ol"></i>
            Historique
          </button>
        </div>
      </div>
    </div>

    <!-- SCENE SPECIALE -->
    <div id="special-reward" class="special-reward-scene">
      <div class="scene-content">
        <h2>INCROYABLE !</h2>
        <p>Une supportrice te remet la m√©daille d'or !</p>
        <div class="couple-emojis">
          üëß ‚ù§Ô∏è üë¶
          <div class="kiss-mark">üíã</div>
        </div>
        <div><i class="fa-solid fa-medal medal-icon"></i></div>
        <p style="margin-top: 20px; font-size: 0.9rem; color: #7f8c8d">
          (Clique pour fermer)
        </p>
      </div>
    </div>

    <div class="version-tag">v3.6</div>

    <script>
      const wordsDatabase = [
        "Voiture",
        "Moteur",
        "Rapide",
        "Circuit",
        "Pilote",
        "Vitesse",
        "Garage",
        "Volant",
        "Pneu",
        "Route",
        "Camion",
        "V√©lo",
        "Train",
        "Avion",
        "Bateau",
        "Fus√©e",
        "Voyage",
        "Monde",
        "Valise",
        "Carte",
        "√âcole",
        "Classe",
        "Ma√Ætre",
        "Cahier",
        "Stylo",
        "Livre",
        "Histoire",
        "Maths",
        "Po√©sie",
        "Dessin",
        "Maison",
        "Jardin",
        "Chambre",
        "Cuisine",
        "Salon",
        "Fen√™tre",
        "Porte",
        "Toit",
        "Mur",
        "Escalier",
        "Chat",
        "Chien",
        "Oiseau",
        "Poisson",
        "Cheval",
        "Vache",
        "Mouton",
        "Poule",
        "Lapin",
        "Tigre",
        "Lion",
        "√âl√©phant",
        "Girafe",
        "Singe",
        "Z√®bre",
        "Loup",
        "Ours",
        "Renard",
        "Aigle",
        "Requin",
        "Pomme",
        "Poire",
        "Banane",
        "Fraise",
        "Cerise",
        "Orange",
        "Citron",
        "Raisin",
        "Melon",
        "P√™che",
        "Pain",
        "Beurre",
        "Lait",
        "Fromage",
        "Oeuf",
        "Viande",
        "Poulet",
        "Frites",
        "Pizza",
        "P√¢tes",
        "Eau",
        "Jus",
        "Soda",
        "Glace",
        "G√¢teau",
        "Bonbon",
        "Chocolat",
        "Sucre",
        "Sel",
        "Poivre",
        "Rouge",
        "Bleu",
        "Vert",
        "Jaune",
        "Noir",
        "Blanc",
        "Gris",
        "Rose",
        "Violet",
        "Orange",
        "Grand",
        "Petit",
        "Gros",
        "Mince",
        "Long",
        "Court",
        "Haut",
        "Bas",
        "Large",
        "√âtroit",
        "Beau",
        "Joli",
        "Laid",
        "Propre",
        "Sale",
        "Chaud",
        "Froid",
        "Sec",
        "Mouill√©",
        "Dur",
        "Gentil",
        "M√©chant",
        "Triste",
        "Joyeux",
        "F√¢ch√©",
        "Peureux",
        "Courageux",
        "Fort",
        "Faible",
        "Malade",
        "Courir",
        "Marcher",
        "Sauter",
        "Voler",
        "Nager",
        "Danser",
        "Chanter",
        "Parler",
        "√âcouter",
        "Regarder",
        "Manger",
        "Boire",
        "Dormir",
        "R√™ver",
        "Jouer",
        "Gagner",
        "Perdre",
        "Lire",
        "√âcrire",
        "Compter",
        "Aimer",
        "D√©tester",
        "Vouloir",
        "Pouvoir",
        "Savoir",
        "Devoir",
        "Prendre",
        "Donner",
        "Jeter",
        "Attraper",
        "Ouvrir",
        "Fermer",
        "Allumer",
        "√âteindre",
        "Monter",
        "Descendre",
        "Entrer",
        "Sortir",
        "Partir",
        "Rester",
        "Soleil",
        "Lune",
        "√âtoile",
        "Nuage",
        "Pluie",
        "Neige",
        "Vent",
        "Orage",
        "Ciel",
        "Terre",
        "Mer",
        "Oc√©an",
        "Rivi√®re",
        "Lac",
        "Montagne",
        "Colline",
        "For√™t",
        "Arbre",
        "Fleur",
        "Herbe",
        "Ville",
        "Village",
        "Rue",
        "Pont",
        "Place",
        "Parc",
        "Magasin",
        "March√©",
        "H√¥pital",
        "Cin√©ma",
        "Matin",
        "Midi",
        "Soir",
        "Nuit",
        "Jour",
        "Semaine",
        "Mois",
        "Ann√©e",
        "Heure",
        "Minute",
        "Lundi",
        "Mardi",
        "Mercredi",
        "Jeudi",
        "Vendredi",
        "Samedi",
        "Dimanche",
        "Janvier",
        "F√©vrier",
        "Mars",
        "Printemps",
        "√ât√©",
        "Automne",
        "Hiver",
        "No√´l",
        "P√¢ques",
        "Vacances",
        "F√™te",
        "Anniversaire",
        "Cadeau",
        "Un",
        "Deux",
        "Trois",
        "Quatre",
        "Cinq",
        "Six",
        "Sept",
        "Huit",
        "Neuf",
        "Dix",
        "Onze",
        "Douze",
        "Treize",
        "Quatorze",
        "Quinze",
        "Seize",
        "Vingt",
        "Trente",
        "Quarante",
        "Cinquante",
        "Cent",
        "Mille",
        "Million",
        "Premier",
        "Dernier",
        "Avant",
        "Apr√®s",
        "Maintenant",
        "Demain",
        "Hier",
        "Moi",
        "Toi",
        "Lui",
        "Elle",
        "Nous",
        "Vous",
        "Ils",
        "Elles",
        "Mon",
        "Ton",
        "Son",
        "Notre",
        "Votre",
        "Leur",
        "Le",
        "La",
        "Les",
        "Un",
        "Une",
        "Des",
        "Et",
        "Ou",
        "Mais",
        "Donc",
        "Car",
        "Parce que",
        "Quand",
        "O√π",
        "Comment",
        "Pourquoi",
        "Biblioth√®que",
        "Ordinateur",
        "T√©l√©vision",
        "T√©l√©phone",
        "Internet",
        "Jeux",
        "Vid√©o",
        "Musique",
        "Sport",
        "Ballon",
        "Dinosaure",
        "Pirate",
        "Chevalier",
        "Princesse",
        "Ch√¢teau",
        "Dragon",
        "F√©e",
        "Sorcier",
        "Magie",
        "Tr√©sor",
      ];

      let currentScore = 0;
      let timeLeft = 60;
      let timerInterval;
      let gameActive = false;
      let availableWords = [];
      let audioCtx;

      window.onload = function () {
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        audioCtx = new AudioContext();
      };

      function speak(text) {
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = "fr-FR";
          window.speechSynthesis.speak(utterance);
        }
      }

      function playStartSound() {
        if (!audioCtx) return;
        if (audioCtx.state === "suspended") audioCtx.resume();

        const t = audioCtx.currentTime;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = "sawtooth";
        osc.frequency.setValueAtTime(100, t);
        osc.frequency.exponentialRampToValueAtTime(600, t + 0.8);
        osc.frequency.linearRampToValueAtTime(100, t + 1.2);
        gain.gain.setValueAtTime(0.3, t);
        gain.gain.linearRampToValueAtTime(0, t + 1.2);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(t + 1.3);
      }

      function playEngineSound() {
        if (!audioCtx) return;
        if (audioCtx.state === "suspended") audioCtx.resume();
        const t = audioCtx.currentTime;
        const osc1 = audioCtx.createOscillator();
        const gain1 = audioCtx.createGain();
        osc1.type = "sawtooth";
        osc1.frequency.setValueAtTime(120, t);
        osc1.frequency.linearRampToValueAtTime(400, t + 0.2);
        gain1.gain.setValueAtTime(0.2, t);
        gain1.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
        osc1.connect(gain1);
        gain1.connect(audioCtx.destination);
        osc1.start();
        osc1.stop(t + 0.3);
      }

      function goMenu() {
        document.getElementById("screen-history").style.display = "none";
        document.getElementById("screen-menu").style.display = "flex";
        document.getElementById("screen-result").style.display = "none";
      }

      function showHistory() {
        document.getElementById("screen-menu").style.display = "none";
        document.getElementById("screen-result").style.display = "none";
        document.getElementById("screen-history").style.display = "flex";

        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];
        const container = document.getElementById("history-container");

        if (scores.length === 0) {
          container.innerHTML =
            "<div style='color:#ccc; text-align:center;'>Aucune course enregistr√©e</div>";
        } else {
          container.innerHTML = scores
            .map((s, i) => {
              // Compatibilit√© anciens scores (qui n'√©taient que des nombres)
              let scoreVal = typeof s === "object" ? s.score : s;
              let dateVal = typeof s === "object" ? s.date : "";

              return `<div class="history-item">
                        <span>#${i + 1}</span>
                        <div>
                            <span class="history-score">${scoreVal} mots</span>
                            ${
                              dateVal
                                ? `<span class="history-date">${dateVal}</span>`
                                : ""
                            }
                        </div>
                    </div>`;
            })
            .join("");
        }
      }

      function resetScores() {
        if (confirm("Effacer tout l'historique ?")) {
          localStorage.removeItem("baptiste_racing_scores");
          showHistory();
        }
      }

      function startCountdown() {
        playStartSound();
        document.getElementById("screen-menu").style.display = "none";
        document.getElementById("screen-countdown").style.display = "flex";

        availableWords = [...wordsDatabase].sort(() => Math.random() - 0.5);
        currentScore = 0;
        timeLeft = 60;

        const lights = {
          red: document.getElementById("light-red"),
          orange: document.getElementById("light-orange"),
          green: document.getElementById("light-green"),
        };
        const countText = document.getElementById("countdown-display");

        lights.red.className = "light red";
        lights.orange.className = "light orange";
        lights.green.className = "light green";

        setTimeout(() => {
          lights.red.classList.add("active");
          countText.innerText = "3";
          playBeep(400);
        }, 500);
        setTimeout(() => {
          lights.orange.classList.add("active");
          countText.innerText = "2";
          playBeep(400);
        }, 1500);
        setTimeout(() => {
          lights.red.classList.remove("active");
          lights.orange.classList.remove("active");
          lights.green.classList.add("active");
          countText.innerText = "1";
          playBeep(400);
        }, 2500);

        setTimeout(() => {
          countText.innerText = "GO !";
          playBeep(800);
          setTimeout(startGame, 500);
        }, 3500);
      }

      function playBeep(freq) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.value = freq;
        osc.type = "square";
        gain.gain.value = 0.1;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
      }

      function startGame() {
        document.getElementById("screen-countdown").style.display = "none";
        document.getElementById("screen-game").style.display = "flex";
        gameActive = true;

        updateHUD();
        showNextWord();

        timerInterval = setInterval(() => {
          timeLeft--;
          updateHUD();

          // Beep fin de course
          if (timeLeft <= 5 && timeLeft > 0) {
            playBeep(600);
          }

          if (timeLeft <= 0) {
            endGame();
          }
        }, 1000);
      }

      function nextWord() {
        if (!gameActive) return;
        const btn = document.querySelector(".btn-next-word");
        btn.style.transform = "scale(0.95)";
        setTimeout(() => (btn.style.transform = "scale(1)"), 100);
        playEngineSound();
        currentScore++;
        updateHUD();
        showNextWord();
      }

      function showNextWord() {
        if (availableWords.length === 0)
          availableWords = [...wordsDatabase].sort(() => Math.random() - 0.5);
        const word = availableWords.pop();
        const wordEl = document.getElementById("current-word");
        wordEl.innerText = word;
        const fonts = ["font-classic", "font-script", "font-school"];
        wordEl.className = fonts[Math.floor(Math.random() * fonts.length)];
      }

      function updateHUD() {
        document.getElementById("timer-display").innerText = timeLeft;
        document.getElementById("word-count-display").innerText = currentScore;
        if (timeLeft <= 10)
          document.getElementById("timer-display").style.color = "#e74c3c";
        else document.getElementById("timer-display").style.color = "white";
      }

      function endGame() {
        clearInterval(timerInterval);
        gameActive = false;
        document.getElementById("screen-game").style.display = "none";
        document.getElementById("screen-result").style.display = "flex";

        // Mise √† jour du texte de fin
        const endText = `Bravo Baptiste, tu as r√©ussi √† lire ${currentScore} mots en moins d'une minute ! Tu es un vrai champion de lecture !`;
        document.getElementById("champ-message-text").innerText = endText;

        saveScore(currentScore);
        showPodium(currentScore);

        speak(endText);
        launchFireworks();
      }

      function launchFireworks() {
        const duration = 5000;
        const animationEnd = Date.now() + duration;
        const defaults = {
          startVelocity: 30,
          spread: 360,
          ticks: 60,
          zIndex: 0,
        };
        const interval = setInterval(function () {
          const timeLeft = animationEnd - Date.now();
          if (timeLeft <= 0) return clearInterval(interval);
          const particleCount = 50 * (timeLeft / duration);
          confetti(
            Object.assign({}, defaults, {
              particleCount,
              origin: { x: Math.random(), y: Math.random() - 0.2 },
            })
          );
        }, 250);
      }

      function saveScore(score) {
        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];

        // Cr√©ation de l'objet score avec date
        const now = new Date();
        const dateStr =
          now.toLocaleDateString("fr-FR") +
          " " +
          now.toLocaleTimeString("fr-FR", {
            hour: "2-digit",
            minute: "2-digit",
          });

        scores.push({ score: score, date: dateStr });

        // Tri d√©croissant
        scores.sort((a, b) => {
          let scoreA = typeof a === "object" ? a.score : a;
          let scoreB = typeof b === "object" ? b.score : b;
          return scoreB - scoreA;
        });

        localStorage.setItem("baptiste_racing_scores", JSON.stringify(scores));
      }

      function showPodium(newScore) {
        let scores =
          JSON.parse(localStorage.getItem("baptiste_racing_scores")) || [];

        // Extraction des valeurs de score pour l'affichage (gestion compatibilit√© vieux format)
        const getScoreVal = (item) =>
          typeof item === "object" ? item.score : item;

        const top1 = scores[0] ? getScoreVal(scores[0]) : "-";
        const top2 = scores[1] ? getScoreVal(scores[1]) : "-";
        const top3 = scores[2] ? getScoreVal(scores[2]) : "-";

        // Rang : on cherche l'index du nouveau score.
        // Attention : s'il y a des doublons de scores, indexOf renvoie le premier.
        // Pour √™tre pr√©cis, on cherche l'index de l'objet qu'on vient d'ajouter, ou simplement le rang th√©orique.
        // Ici, une approximation par la valeur du score suffit pour l'animation.
        const rank = scores.findIndex((s) => getScoreVal(s) === newScore) + 1;

        const podiumDiv = document.getElementById("podium");
        podiumDiv.innerHTML = `
                <div class="step step-2">
                    <div class="rank-num">2</div>
                    <div class="score-on-step">${top2}</div>
                    ${
                      rank === 2
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
                <div class="step step-1">
                    <div class="rank-num">1</div>
                    <div class="score-on-step">${top1}</div>
                    ${
                      rank === 1
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
                <div class="step step-3">
                    <div class="rank-num">3</div>
                    <div class="score-on-step">${top3}</div>
                    ${
                      rank === 3
                        ? '<div class="avatar baptiste"><i class="fa-solid fa-child-reaching"></i></div>'
                        : ""
                    }
                </div>
            `;

        if (rank > 3) {
          setTimeout(() => {
            document.getElementById("special-reward").style.display = "flex";
            document.getElementById("special-reward").onclick = function () {
              this.style.display = "none";
            };
          }, 2000);
        }
      }
    </script>
  </body>
</html>
